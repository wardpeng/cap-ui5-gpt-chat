{"version":3,"file":"ChatService.js","names":["ChatService","getInstance","instance","constructor","setModel","model","createEntity","entity","binding","skipRefresh","atEnd","Promise","resolve","reject","context","create","created","then","getObject","submitBatch","getUpdateGroupId","deleteEntity","delete","getCompletion","params","bindContext","setParameter","chat","personality","dialog","BusyDialog","text","open","execute","close","getBoundContext","error","MessageBox","alert","message","title"],"sources":["ChatService.ts"],"sourcesContent":["import BusyDialog from \"sap/m/BusyDialog\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport Context from \"sap/ui/model/odata/v4/Context\";\nimport ODataContextBinding from \"sap/ui/model/odata/v4/ODataContextBinding\";\nimport ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport { IFuncGetCompletionParams, FuncGetCompletionReturn } from \"../types/ChatService\";\n\nexport default class ChatService {\n  private static instance: ChatService;\n  private model: ODataModel;\n\n  public static getInstance(): ChatService {\n    this.instance ??= new ChatService();\n    return this.instance;\n  }\n  private constructor() {}\n\n  public setModel(model: ODataModel): void {\n    this.model = model;\n  }\n\n  /**\n   * Creates a single entity in the OData service by using the ODataListBinding.\n   *\n   * @param entity {T}\n   * @param binding {sap.ui.model.odata.v4.ODataListBinding}\n   * @param skipRefresh {boolean}\n   * @param atEnd {boolean}\n   * @returns {Promise<T>}\n   */\n  public createEntity<T extends Object>(\n    entity: T,\n    binding: ODataListBinding,\n    skipRefresh = false,\n    atEnd = false\n  ): Promise<T> {\n    return new Promise((resolve, reject) => {\n      const context = binding.create(entity, skipRefresh, atEnd);\n      context.created().then(() => {\n        resolve(context.getObject());\n      }, reject);\n      this.model.submitBatch(this.model.getUpdateGroupId());\n    });\n  }\n\n  /**\n   * Deletes a single entity in the OData service by using the ODataContextBinding.\n   *\n   * @param context {sap.ui.model.odata.v4.Context}\n   * @returns {Promise<void>}\n   */\n  public deleteEntity(context: Context): Promise<void> {\n    return new Promise((resolve, reject) => {\n      context.delete().then(resolve, reject);\n      this.model.submitBatch(this.model.getUpdateGroupId());\n    });\n  }\n\n  /**\n   * Retrieve the completion from the OData service by calling the getCompletion function.\n   *\n   * @param params {IFuncGetCompletionParams}\n   * @returns {Promise<ICompletion>}\n   */\n  public async getCompletion(params: IFuncGetCompletionParams): Promise<FuncGetCompletionReturn> {\n    return new Promise((resolve, reject) => {\n      const binding = <ODataContextBinding>this.model.bindContext(\"/getCompletion(...)\");\n      binding.setParameter(\"model\", params.model);\n      binding.setParameter(\"chat\", params.chat);\n      binding.setParameter(\"personality\", params.personality);\n      const dialog = new BusyDialog({ text: \"Thinking...\" });\n      dialog.open();\n      binding.execute().then(\n        () => {\n          dialog.close();\n          resolve(<FuncGetCompletionReturn>binding.getBoundContext().getObject());\n        },\n        (error) => {\n          dialog.close();\n          MessageBox.alert(error.message, {\n            title: \"Error\",\n          });\n          reject(error);\n        }\n      );\n    });\n  }\n}\n"],"mappings":";EAQe,MAAMA,WAAW,CAAC;IAI/B,OAAcC,WAAW,GAAgB;MACvC,IAAI,CAACC,QAAQ,KAAK,IAAIF,WAAW,EAAE;MACnC,OAAO,IAAI,CAACE,QAAQ;IACtB;IACQC,WAAW,GAAG,CAAC;IAEhBC,QAAQ,CAACC,KAAiB,EAAQ;MACvC,IAAI,CAACA,KAAK,GAAGA,KAAK;IACpB;;IAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACSC,YAAY,CACjBC,MAAS,EACTC,OAAyB,EACzBC,WAAW,GAAG,KAAK,EACnBC,KAAK,GAAG,KAAK,EACD;MACZ,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACtC,MAAMC,OAAO,GAAGN,OAAO,CAACO,MAAM,CAACR,MAAM,EAAEE,WAAW,EAAEC,KAAK,CAAC;QAC1DI,OAAO,CAACE,OAAO,EAAE,CAACC,IAAI,CAAC,MAAM;UAC3BL,OAAO,CAACE,OAAO,CAACI,SAAS,EAAE,CAAC;QAC9B,CAAC,EAAEL,MAAM,CAAC;QACV,IAAI,CAACR,KAAK,CAACc,WAAW,CAAC,IAAI,CAACd,KAAK,CAACe,gBAAgB,EAAE,CAAC;MACvD,CAAC,CAAC;IACJ;;IAEA;AACF;AACA;AACA;AACA;AACA;IACSC,YAAY,CAACP,OAAgB,EAAiB;MACnD,OAAO,IAAIH,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACtCC,OAAO,CAACQ,MAAM,EAAE,CAACL,IAAI,CAACL,OAAO,EAAEC,MAAM,CAAC;QACtC,IAAI,CAACR,KAAK,CAACc,WAAW,CAAC,IAAI,CAACd,KAAK,CAACe,gBAAgB,EAAE,CAAC;MACvD,CAAC,CAAC;IACJ;;IAEA;AACF;AACA;AACA;AACA;AACA;IACE,MAAaG,aAAa,CAACC,MAAgC,EAAoC;MAC7F,OAAO,IAAIb,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACtC,MAAML,OAAO,GAAwB,IAAI,CAACH,KAAK,CAACoB,WAAW,CAAC,qBAAqB,CAAC;QAClFjB,OAAO,CAACkB,YAAY,CAAC,OAAO,EAAEF,MAAM,CAACnB,KAAK,CAAC;QAC3CG,OAAO,CAACkB,YAAY,CAAC,MAAM,EAAEF,MAAM,CAACG,IAAI,CAAC;QACzCnB,OAAO,CAACkB,YAAY,CAAC,aAAa,EAAEF,MAAM,CAACI,WAAW,CAAC;QACvD,MAAMC,MAAM,GAAG,IAAIC,UAAU,CAAC;UAAEC,IAAI,EAAE;QAAc,CAAC,CAAC;QACtDF,MAAM,CAACG,IAAI,EAAE;QACbxB,OAAO,CAACyB,OAAO,EAAE,CAAChB,IAAI,CACpB,MAAM;UACJY,MAAM,CAACK,KAAK,EAAE;UACdtB,OAAO,CAA0BJ,OAAO,CAAC2B,eAAe,EAAE,CAACjB,SAAS,EAAE,CAAC;QACzE,CAAC,EACAkB,KAAK,IAAK;UACTP,MAAM,CAACK,KAAK,EAAE;UACdG,UAAU,CAACC,KAAK,CAACF,KAAK,CAACG,OAAO,EAAE;YAC9BC,KAAK,EAAE;UACT,CAAC,CAAC;UACF3B,MAAM,CAACuB,KAAK,CAAC;QACf,CAAC,CACF;MACH,CAAC,CAAC;IACJ;EACF;EAAC;AAAA"}